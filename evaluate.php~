<?php
namespace Infojor;

use Infojor\Service\UserService;
use Infojor\Service\SchoolService;
use Infojor\Presentation\Model\UserViewModel;
use Infojor\Presentation\Model\SchoolViewModel;
use Infojor\Presentation\Controller\Controller;

session_start();
if (!isset($_SESSION['userid'])) {
	header('Location: login.php');
}

require_once "bootstrap.php";
require_once 'Loader.php';
new Loader();

$xml = 'presentation/template/evaluate.xml';
$tss = 'presentation/template/evaluate.tss';
$template = new \Transphporm\Builder($xml, $tss);

$userModel = new UserService($entityManager);
$userViewModel = new UserViewModel($userModel);
$controller = new Controller($userViewModel);

$schoolModel = new SchoolService($entityManager);
$schoolViewModel = new SchoolViewModel($schoolModel);

//if (isset($_GET['action'])) {
//	$controller->{$_GET['action']}();
//}
$userId = $_SESSION['userid'];
$classroomId = $_SESSION['classroomid'];
$userId = 1;
$classroomId = 7;

$course = $schoolViewModel->getActiveCourse();
$trimestre = $schoolViewModel->getActiveTrimestre();
$user = $userViewModel->getTeacher($userId);
$data = $schoolViewModel->getCurrentClassroomStudents($classroomId);
$data = (object) array_merge((array) $user, (array) $course, (array) $trimestre, (array) $data);
var_dump($data);
echo $template->output($data)->body;
?>
