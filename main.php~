<?php
namespace Infojor;

use Infojor\Service\UserService;
use Infojor\Presentation\Model\UserViewModel;
use Infojor\Presentation\Controller\Controller;

?>
<!doctype html>
<?php

require_once 'init.php';

if (isset($_SESSION['userid'])) {
	$userid = $_SESSION['userid'];
} else {
	header('Location: login.php');
	$userid = 1;
}
	
$userModel = new UserService($entityManager);
$userViewModel = new UserViewModel($userModel, $entityManager);
$controller = new Controller($userViewModel);

//if (isset($_GET['action'])) {
//	$controller->{$_GET['action']}();
//}

$sections = $userViewModel->getCurrentSections($userid);

var_dump($sections);

$inner = '';
foreach ($sections as $section) {
	var_dump($section);
	$inner .= '<h2>' . $section['name'] . '</h2>'; 
	$template = new \Transphporm\Builder(TPLDIR.'main.section.xml', TPLDIR.'main.section.tss');
	$inner .= $template->output($section)->body;
}

echo($inner); 

//$template = new \Transphporm\Builder(TPLDIR.'main.xml', TPLDIR.'main.tss');

//var_dump($data);
//$data = (object) array_merge((array) $header, (array) $data);
//echo $template->output($data)->body;
